<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#1a1d27">
    <meta name="description" content="Master professional parametric design with our comprehensive course">
    
    <title>Professional Parametric Design | Interactive Learning</title>
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@300;400;500&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    
    <!-- Fallback fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Enhanced Touch Interaction System */
        .touch-active {
            transform: scale(0.97);
            transition: all 0.3s cubic-bezier(0.2, 0, 0.1, 1);
            opacity: 0.9;
        }
        
        /* Smooth blend transition */
        .blend-transition {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: transform, opacity, background-color;
        }
        
        /* Ripple effect */
        .ripple {
            position: absolute;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0) 70%);
            border-radius: 50%;
            pointer-events: none;
            transform: translate(-50%, -50%) scale(0);
            animation: ripple 1s cubic-bezier(0.22, 1, 0.36, 1);
            z-index: 1000;
            opacity: 0;
            will-change: transform, opacity;
            mix-blend-mode: overlay;
        }
        
        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
        
        /* Touch glow effect */
        .touch-glow {
            position: fixed;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 70%);
            border-radius: 50%;
            pointer-events: none;
            transform: translate(-50%, -50%) scale(0);
            animation: touchGlow 1s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 999;
        }
        
        @keyframes touchGlow {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0.5; }
            50% { opacity: 0.3; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
        }
        
        /* Enhanced Physics-based card interactions */
        .module-card {
            transform-style: preserve-3d;
            transition: all 0.6s cubic-bezier(0.22, 1, 0.36, 1);
            will-change: transform, box-shadow, background, border-color;
            position: relative;
            overflow: hidden;
            transform: translateZ(0);
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            -webkit-transform-style: preserve-3d;
        }
        
        .module-card:hover {
            transform: translateY(-8px) rotateX(2deg) rotateY(2deg) scale(1.02);
            box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.6) !important;
            background: rgba(45, 48, 63, 0.8);
            border-color: rgba(255, 255, 255, 0.15);
        }
        
        /* Enhanced touch feedback */
        @media (hover: none) {
            .module-card:active {
                transform: scale(0.97) !important;
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
                background: rgba(50, 53, 70, 0.9);
            }
            
            /* Smoother scrolling on touch devices */
            html {
                -webkit-overflow-scrolling: touch;
                scroll-behavior: smooth;
            }
        }

        /* =========================
           ENHANCED TOUCH INTERACTIONS
           ========================= */
        .touch-feedback {
            position: relative;
            overflow: hidden;
            transform: translateZ(0);
        }
        
        .touch-ripple {
            position: absolute;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.2);
            transform: scale(0);
            pointer-events: none;
            animation: ripple 0.6s linear;
        }
        
        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
        
        /* Physics-based animations */
        .physics-card {
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), 
                        box-shadow 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: transform, box-shadow;
        }
        
        .physics-card:hover {
            transform: translateY(-8px) rotateX(2deg) rotateY(2deg);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5) !important;
        }
        
        /* Touch feedback */
        @media (hover: none) {
            .touch-feedback:active {
                transform: scale(0.98);
                transition: transform 0.1s ease-out;
            }
        }
        
        /* Ripple effect styles */
        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            transform: scale(0);
            pointer-events: none;
            animation: ripple 0.6s linear;
            z-index: 1;
        }
        
        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
        
        /* =========================
           BASE STYLES - IGLOO INSPIRED
           ========================= */
        :root {
            --primary: #b6bac5;
            --primary-light: #d4d7de;
            --accent: #8a8f9d;
            --accent-dark: #6b7080;
            --dark: #1a1d27;
            --mid: #252834;
            --card: rgba(37, 40, 52, 0.65);
            --light: #b6bac5;
            --text-primary: #e8eaed;
            --text-secondary: rgba(182, 186, 197, 0.85);
            --text-muted: rgba(182, 186, 197, 0.55);
            --border: rgba(182, 186, 197, 0.12);
            --border-strong: rgba(182, 186, 197, 0.22);
            --radius-lg: 16px;
            --radius-md: 12px;
            --shadow-lg: 0 24px 60px rgba(0,0,0,0.5);
            --shadow-md: 0 16px 40px rgba(0,0,0,0.4);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Space Grotesk', sans-serif;
            background: 
                radial-gradient(circle at 20% 30%, rgba(182, 186, 197, 0.04), transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(138, 143, 157, 0.03), transparent 45%),
                radial-gradient(circle at 50% 50%, rgba(107, 112, 128, 0.02), transparent 60%),
                #1a1d27;
            color: var(--light);
            overflow-x: hidden;
            font-weight: 400;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            opacity: 0;
            transition: opacity 0.6s ease;
        }
        
        body.loaded {
            opacity: 1;
        }

        /* Gallery Styles */
        .gallery-section {
            padding: 20px 0;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            margin: 30px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .gallery-section h2 {
            text-align: center;
            margin-bottom: 25px;
            color: var(--text-primary);
            font-size: 24px;
        }
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 20px;
            padding: 0 20px;
        }
        .gallery-item {
            position: relative;
            overflow: hidden;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            aspect-ratio: 16/9;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 25px rgba(0, 0, 0, 0.25);
            transform: translateZ(0);
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            -webkit-transform-style: preserve-3d;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            box-sizing: border-box;
        }
        
        .gallery-item:hover {
            transform: translateY(-6px) scale(1.03) translateZ(0);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.35),
                        0 0 0 1px rgba(255, 255, 255, 0.2),
                        0 0 30px rgba(255, 255, 255, 0.15),
                        0 0 100px 30px rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.25);
        }
        .gallery-item img {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            object-position: center;
            display: block;
            transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            will-change: transform;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 4px;
        }
        .gallery-item:hover img {
            transform: scale(1.05);
        }
        .gallery-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            text-align: center;
            font-size: 14px;
            backdrop-filter: blur(4px);
        }
        
        /* Form Evolution Styles - Vertical Flow */
        .form-evolution-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 40px;
            margin: 30px auto;
            max-width: 800px;
            padding: 0 20px;
        }
        
        .form-evolution-item {
            width: 100%;
            text-align: center;
            position: relative;
            padding: 30px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-lg);
            border: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.3s ease;
        }
        
        .form-evolution-item:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .form-evolution-item h3 {
            color: var(--text-primary);
            margin: 0 0 20px 0;
            font-size: 1.5em;
            font-weight: 600;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .evolution-arrow {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%) rotate(90deg);
            font-size: 1.25em;
            color: var(--accent);
            opacity: 0.4;
            z-index: 2;
            background: var(--dark);
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .form-evolution-item:hover .evolution-arrow {
            opacity: 0.7;
            transform: translateX(-50%) rotate(90deg) scale(1.1);
        }
        
        .form-evolution-item:last-child .evolution-arrow {
            display: none;
        }
        
        .form-variants {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .form-variants .gallery-item {
            flex: 1;
            min-width: 200px;
            max-width: 400px;
            margin: 0;
            height: 300px;
        }
        
        .coming-soon {
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.03);
            border: 2px dashed rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-md);
            color: var(--text-muted);
            font-size: 1.2em;
            font-style: italic;
            transition: all 0.3s ease;
        }
        
        .coming-soon:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--accent);
            color: var(--accent);
        }
        
        @media (max-width: 768px) {
            .form-evolution-item {
                padding: 20px 15px;
            }
            
            .form-variants {
                flex-direction: column;
                align-items: center;
            }
            
            .form-variants .gallery-item {
                width: 100%;
                max-width: 100%;
            }
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            overflow: auto;
            opacity: 0;
            transition: opacity 0.4s ease;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }
        
        .modal.show {
            display: block;
            opacity: 1;
        }
        
        .modal-content {
            margin: auto;
            display: block;
            max-width: 90vw;
            max-height: 90vh;
            width: auto;
            height: auto;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            border-radius: var(--radius-md);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.15),
                        0 0 20px 5px rgba(255, 255, 255, 0.2),
                        0 0 50px 15px rgba(255, 255, 255, 0.15),
                        0 0 100px 30px rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            opacity: 0;
            object-fit: contain;
            object-position: center;
            background: rgba(30, 33, 40, 0.98);
            padding: 20px;
            box-sizing: border-box;
        }
        
        .modal.show .modal-content {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }
        
        #caption {
            margin: 15px auto;
            display: block;
            width: 80%;
            max-width: 700px;
            text-align: center;
            color: var(--text-secondary);
            padding: 10px 0;
            height: auto;
            min-height: 25px;
            font-size: 18px;
            font-weight: 400;
            line-height: 1.5;
        }
        
        .close {
            position: absolute;
            top: 15px;
            right: 35px;
            color: var(--text-primary);
            font-size: 40px;
            font-weight: 300;
            cursor: pointer;
            z-index: 1001;
            opacity: 0.7;
            transition: opacity 0.2s ease, transform 0.2s ease;
        }
        
        .close:hover,
        .close:focus {
            opacity: 1;
            transform: rotate(90deg);
            text-decoration: none;
        }
        
        .prev, .next {
            cursor: pointer;
            position: absolute;
            top: 50%;
            width: 50px;
            height: 50px;
            padding: 16px;
            margin-top: -25px;
            color: white;
            font-weight: bold;
            font-size: 20px;
            transition: 0.3s;
            user-select: none;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 1001;
        }
        
        .next {
            right: 20px;
        }
        
        .prev {
            left: 20px;
        }
        
        .prev:hover, .next:hover {
            background-color: rgba(0, 0, 0, 0.8);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        @media (max-width: 768px) {
            .gallery-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
                gap: 15px;
                padding: 0 15px;
            }
            .gallery-section h2 {
                font-size: 20px;
            }
            
            .prev, .next {
                width: 40px;
                height: 40px;
                font-size: 16px;
                padding: 12px;
            }
            
            .close {
                font-size: 32px;
                right: 20px;
                top: 10px;
            }
        }
    </style>
    
    <!-- Mobile web app meta tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Parametric Design">
</head>
<body>
    <div class="grid-background"></div>
    
    <div class="container">
        <!-- Background elements -->
        <div class="grid-background" aria-hidden="true"></div>
        <div class="geometric-shape shape1" aria-hidden="true"></div>
        <div class="geometric-shape shape2" aria-hidden="true"></div>
        <div class="geometric-shape shape3" aria-hidden="true"></div>
        
        <header class="touch-feedback">
            <span class="course-tag">Re-Thinking BIM</span>
            <h1>NOMAD, Manhattan <span class="gradient-text">Bimmer</span></h1>
            <p class="subtitle">Sara Lin, Sriya Thotakura | CDP, Columbia GSAPP</p>
        </header>

        <div class="content-grid">
            <div class="module-card touch-feedback">
                <div class="module-number">01</div>
                <h3>Design Compliance</h3>
                <p>Understand the rules of Maximum Form Constraints.</p>
                <div class="tech-tags">
                    <span class="tech-tag touch-feedback">Targets</span>
                    <span class="tech-tag touch-feedback">Grasshopper</span>
                </div>
            </div>

            <div class="module-card touch-feedback">
                <div class="module-number">02</div>
                <h3>Computational Analysis</h3>
                <p>To Optimise Design through Logic</p>
                <div class="tech-tags">
                    <span class="tech-tag touch-feedback">Revit</span>
                    <span class="tech-tag touch-feedback">ArchiCAD</span>
                </div>
            </div>

            <div class="module-card touch-feedback">
                <div class="module-number">03</div>
                <h3>Attribute</h3>
                <p> Bridge Design with Building Information Modeling workflows</p>
                <div class="tech-tags">
                    <span class="tech-tag touch-feedback">Python</span>
                    <span class="tech-tag touch-feedback">C#</span>
                </div>
            </div>
        </div>

        <div class="cta-section">
            <h2>Site Journey</h2>
            <p>Location: 1225 Broadway, 404B</p>
            <button class="cta-button touch-feedback" aria-label="Enroll in the course">
                <span class="button-text">M1-8A/R12</span>
                <!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Site Character — Bubble Diagram</title>

  <style>
    :root{
      --bg: #0b1020;
      --panel: rgba(255,255,255,0.04);
      --panel2: rgba(255,255,255,0.02);
      --stroke: rgba(255,255,255,0.12);
      --text: rgba(230,237,248,0.92);
      --muted: rgba(230,237,248,0.65);

      /* keep your existing palette; tweak for contrast */
      --left:  rgba(22,198,226,0.95);  /* Broadway side accent */
      --right: rgba(167,139,250,0.95); /* 29th/30th side accent */
      --center: rgba(251,191,36,0.95); /* Site node accent */
    }

    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(900px 650px at 20% 30%, rgba(22,198,226,0.10), transparent 55%),
        radial-gradient(900px 650px at 85% 75%, rgba(167,139,250,0.10), transparent 55%),
        radial-gradient(900px 650px at 50% 50%, rgba(107,112,128,0.02), transparent 60%),
        #1a1d27;
      color: var(--text);
    }

    .wrap{
      max-width: 1100px;
      margin: 0 auto;
      padding: 28px 18px 34px;
    }

    .title{
      display:flex;
      gap:12px;
      align-items:baseline;
      flex-wrap:wrap;
      margin-bottom: 10px;
    }

    .title h1{
      font-size: 22px;
      margin: 0;
      letter-spacing: -0.02em;
    }

    .title .hint{
      color: var(--muted);
      font-size: 13px;
    }

    .card{
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,0.03);
      border-radius: 16px;
      overflow: hidden;
      position: relative;
    }

    svg{
      width: 100%;
      height: min(70vh, 620px);
      display:block;
    }

    .panel-label{
      font-size: 12px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      fill: rgba(230,237,248,0.70);
    }

    .node text{
      pointer-events: none;
      fill: rgba(230,237,248,0.92);
      font-size: 12px;
      font-weight: 600;
      text-shadow: 0 1px 10px rgba(0,0,0,0.55);
    }

    .node circle{
      stroke: rgba(255,255,255,0.14);
      stroke-width: 1;
      filter: drop-shadow(0px 8px 18px rgba(0,0,0,0.45));
    }

    .tooltip{
      position: fixed;
      inset: auto auto 0 0;
      transform: translate(-9999px,-9999px);
      background: rgba(10,16,34,0.92);
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: 12px;
      padding: 10px 12px;
      color: var(--text);
      font-size: 13px;
      max-width: 280px;
      line-height: 1.35;
      box-shadow: 0 18px 42px rgba(0,0,0,0.55);
      backdrop-filter: blur(12px);
      z-index: 10;
    }

    .tooltip .k{
      color: rgba(230,237,248,0.65);
      font-size: 11px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .legend{
      display:flex;
      gap:14px;
      flex-wrap:wrap;
      padding: 12px 14px;
      border-top: 1px solid rgba(255,255,255,0.10);
      color: var(--muted);
      font-size: 13px;
    }

    .dot{
      width:10px;height:10px;border-radius:999px;display:inline-block;margin-right:8px;
      transform: translateY(1px);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="title">
      <h1>Site Character — Bubble Diagram</h1>
      <div class="hint">Drag bubbles • hover for notes • left/right show "style shifts"</div>
    </div>

    <div class="card">
      <svg id="viz" viewBox="0 0 1100 620" preserveAspectRatio="xMidYMid meet" aria-label="bubble diagram"></svg>
      <div class="legend">
        <span><span class="dot" style="background: var(--left)"></span>Broadway edge</span>
        <span><span class="dot" style="background: var(--right)"></span>29th / 30th West edge</span>
        <span><span class="dot" style="background: var(--center)"></span>Site core</span>
      </div>
    </div>
  </div>

  <div class="tooltip" id="tip"></div>

  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <script>
    const svg = d3.select("#viz");
    const W = 1100, H = 620;

    // Two sides = two "style shifts", plus a central site node
    const nodes = [
      { id:"SITE", group:"center", r:70, desc:"Overall site character anchor / synthesis node." },

      // Left side: Broadway edge
      { id:"Broadway", group:"left", r:56, desc:"Primary frontage / identity edge." },
      { id:"Loading Traffic", group:"left", r:42, desc:"Service / delivery movements shaping curb + timing." },
      { id:"Stalls on Road", group:"left", r:38, desc:"Informal occupancy affecting flow + visibility." },

      // Right side: 29th + 30th West edge
      { id:"29th West", group:"right", r:46, desc:"One of the three-road advantages; alternate access/edge condition." },
      { id:"30th West", group:"right", r:46, desc:"Second of the three-road advantages; distributes entry/exit options." },
      { id:"Bike Path", group:"right", r:40, desc:"Continuous movement corridor; safety + separation cues." },

      // Place this as a "connector" but bias it slightly right by group
      { id:"Guarded Entrance", group:"right", r:44, desc:"Controlled threshold; affects permeability + perception." },
    ];

    // Background "style shift" panels
    const panels = svg.append("g");

    panels.append("rect")
      .attr("x", 20).attr("y", 20)
      .attr("width", (W/2) - 30).attr("height", H - 40)
      .attr("rx", 18)
      .attr("fill", "rgba(255,255,255,0.03)")
      .attr("stroke", "rgba(255,255,255,0.10)")
      .attr("stroke-dasharray", "6 6");

    panels.append("rect")
      .attr("x", (W/2) + 10).attr("y", 20)
      .attr("width", (W/2) - 30).attr("height", H - 40)
      .attr("rx", 18)
      .attr("fill", "rgba(255,255,255,0.02)")
      .attr("stroke", "rgba(255,255,255,0.10)")
      .attr("stroke-dasharray", "6 6");

    panels.append("text")
      .attr("class","panel-label")
      .attr("x", 44).attr("y", 55)
      .text("STYLE SHIFT — BROADWAY EDGE");

    panels.append("text")
      .attr("class","panel-label")
      .attr("x", (W/2) + 34).attr("y", 55)
      .text("STYLE SHIFT — 29TH / 30TH WEST EDGE");

    // Color mapping (keeps palette, changes contrast via opacity/shadows in CSS)
    const color = d => {
      if (d.group === "left") return "rgba(22,198,226,0.92)";
      if (d.group === "right") return "rgba(167,139,250,0.92)";
      return "rgba(251,191,36,0.92)";
    };

    // Force "lanes"
    const xTarget = d => {
      if (d.group === "left") return W * 0.28;
      if (d.group === "right") return W * 0.72;
      return W * 0.50;
    };

    const yTarget = d => H * 0.52;

    const sim = d3.forceSimulation(nodes)
      .force("x", d3.forceX(xTarget).strength(0.08))
      .force("y", d3.forceY(yTarget).strength(0.06))
      .force("collide", d3.forceCollide(d => d.r + 6).iterations(3))
      .force("charge", d3.forceManyBody().strength(-18))
      .alpha(1).restart();

    const g = svg.append("g");

    const node = g.selectAll("g.node")
      .data(nodes)
      .join("g")
      .attr("class","node")
      .call(d3.drag()
        .on("start", dragStart)
        .on("drag", dragged)
        .on("end", dragEnd)
      );

    node.append("circle")
      .attr("r", d => d.r)
      .attr("fill", d => color(d));

    node.append("text")
      .attr("text-anchor","middle")
      .attr("dy","0.35em")
      .each(function(d){
        // simple two-line wrap for long labels
        const words = d.id.split(" ");
        const el = d3.select(this);
        if (d.id.length <= 12 || words.length === 1){
          el.text(d.id);
        } else {
          const mid = Math.ceil(words.length/2);
          el.append("tspan").attr("x",0).attr("dy","-0.15em").text(words.slice(0,mid).join(" "));
          el.append("tspan").attr("x",0).attr("dy","1.2em").text(words.slice(mid).join(" "));
        }
      });

    // Tooltip
    const tip = d3.select("#tip");

    node.on("mousemove", (event, d) => {
      tip.style("transform", `translate(${event.clientX + 14}px, ${event.clientY + 14}px)`)
         .style("opacity", 1)
         .html(`
           <div class="k">${d.group === "left" ? "Broadway edge" : d.group === "right" ? "29th/30th edge" : "Site core"}</div>
           <div style="font-weight:700;margin-top:4px">${d.id}</div>
           <div style="color:rgba(230,237,248,0.72);margin-top:4px">${d.desc}</div>
         `);
    }).on("mouseleave", () => {
      tip.style("transform", "translate(-9999px,-9999px)").style("opacity", 0);
    });

    sim.on("tick", () => {
      node.attr("transform", d => `translate(${d.x},${d.y})`);
    });

    function dragStart(event){
      if (!event.active) sim.alphaTarget(0.22).restart();
      event.subject.fx = event.subject.x;
      event.subject.fy = event.subject.y;
    }
    function dragged(event){
      event.subject.fx = event.x;
      event.subject.fy = event.y;
    }
    function dragEnd(event){
      if (!event.active) sim.alphaTarget(0);
      event.subject.fx = null;
      event.subject.fy = null;
    }
  </script>
</body>
</html>
            </button>

            <!-- Image Gallery Section -->
            <div class="gallery-section" style="margin-top: 40px;">
                <h2>Site Context</h2>
                <div class="gallery-grid">
                    <div class="gallery-item" onclick="openModal('images/street.png', 'Street View')">
                        <img src="images/street.png" alt="Street View">
                        <div class="gallery-caption">Street View</div>
                    </div>
                    <div class="gallery-item" onclick="openModal('images/Surrounding_Building_Types.png', 'Building Types')">
                        <img src="images/Surrounding_Building_Types.png" alt="Building Types">
                        <div class="gallery-caption">Building Types</div>
                    </div>
                    <div class="gallery-item" onclick="openModal('images/Surrounding_transportation.png', 'Transportation')">
                        <img src="images/Surrounding_transportation.png" alt="Transportation">
                        <div class="gallery-caption">Transportation</div>
                    </div>
                    <div class="gallery-item" onclick="openModal('images/Surrounding_vegetation.png', 'Vegetation')">
                        <img src="images/Surrounding_vegetation.png" alt="Vegetation">
                        <div class="gallery-caption">Vegetation</div>
                    </div>
                </div>
            </div>

            <!-- Form Evolution Gallery Section -->
            <div class="gallery-section" style="margin-top: 40px;">
                <h2>Form Evolution</h2>
                <div class="form-evolution-container">
                    <div class="form-evolution-item">
                        <h3>Iteration 1</h3>
                        <div class="gallery-item" onclick="openModal('images/Form_iteration1.png', 'Form Iteration 1 - Initial Concept')">
                            <img src="images/Form_iteration1.png" alt="Form Iteration 1">
                            <div class="gallery-caption">Initial Form Concept</div>
                        </div>
                        <div class="evolution-arrow">↓</div>
                    </div>
                    
                    <div class="form-evolution-item">
                        <h3>Iteration 2</h3>
                        <div class="gallery-item" onclick="openModal('images/Form_iteration2.png', 'Form Iteration 2 - Refined Form')">
                            <img src="images/Form_iteration2.png" alt="Form Iteration 2">
                            <div class="gallery-caption">Refined Form</div>
                        </div>
                        <div class="evolution-arrow">↓</div>
                    </div>
                    
                    <div class="form-evolution-item">
                        <h3>Iteration 3</h3>
                        <div class="form-variants">
                            <div class="gallery-item" onclick="openModal('images/Form_iteration3_1.png', 'Form Iteration 3.1 - Variant A')">
                                <img src="images/Form_iteration3_1.png" alt="Form Iteration 3.1">
                                <div class="gallery-caption">Variant A</div>
                            </div>
                            <div class="gallery-item" onclick="openModal('images/Form_iteration3_2.png', 'Form Iteration 3.2 - Variant B')">
                                <img src="images/Form_iteration3_2.png" alt="Form Iteration 3.2">
                                <div class="gallery-caption">Variant B</div>
                            </div>
                        </div>
                        <div class="evolution-arrow">↓</div>
                    </div>
                    
                    <div class="form-evolution-item">
                        <h3>Final Form</h3>
                        <div class="coming-soon">
                            <span>Coming Soon</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="gallery-section" style="margin-top: 60px; padding: 30px 0; background: rgba(255, 255, 255, 0.03); border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.05);">
                <h2 style="text-align: center; margin-bottom: 30px; color: #e8eaed;">Climate Analysis</h2>
                
                <div style="max-width: 1200px; margin: 0 auto; padding: 0 20px;">
                    <!-- Climate Analysis Images -->
                    <div style="display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; margin-bottom: 30px;">
                        <div class="gallery-item" onclick="openModal('images/Climate analysis.png', 'Climate and Wind Analysis')" style="flex: 1; min-width: 300px; max-width: 480px; border-radius: 8px; overflow: hidden; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); cursor: pointer; transition: transform 0.3s ease;">
                            <img src="images/Climate analysis.png" alt="Climate and Wind Analysis" style="width: 100%; height: auto; display: block; transition: transform 0.3s ease;">
                            <div class="gallery-caption" style="background: rgba(26, 29, 39, 0.8); color: #e8eaed; padding: 12px; text-align: center; font-size: 14px; transition: background-color 0.3s ease;">Climate and Wind Analysis</div>
                        </div>
                        <div class="gallery-item" onclick="openModal('images/Climate.png', 'Climate Analysis')" style="flex: 1; min-width: 300px; max-width: 480px; border-radius: 8px; overflow: hidden; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); cursor: pointer; transition: transform 0.3s ease, box-shadow 0.3s ease;">
                            <img src="images/Climate.png" alt="Climate Analysis" style="width: 100%; height: auto; display: block; transition: transform 0.3s ease;">
                            <div class="gallery-caption" style="background: rgba(26, 29, 39, 0.8); color: #e8eaed; padding: 12px; text-align: center; font-size: 14px; transition: background-color 0.3s ease;">Climate Analysis</div>
                        </div>
                    </div>
                    
                    <!-- Analysis Description -->
                    <div style="max-width: 900px; margin: 0 auto; padding: 25px; background: rgba(26, 29, 39, 0.5); border-radius: 8px; border-left: 4px solid #3b82f6;">
                        <h3 style="color: #3b82f6; margin-top: 0; margin-bottom: 15px;">Wind Analysis</h3>
                        <p style="color: #b6bac5; line-height: 1.7; margin: 0;">
                            Based on this analysis, I conclude that the prevailing winds occur primarily during the summer and fall. Creating open space at the ground level would enhance natural ventilation, which is particularly beneficial for a site located in a dense urban context. In addition, the UTCI map indicates significant heat stress during the summer months; therefore, incorporating shaded areas at the ground level would greatly improve occupant thermal comfort.
                        </p>
                    </div>

                    <!-- Daylight Analysis -->
                    <div style="margin-top: 40px; margin-bottom: 30px;">
                        <div class="gallery-item" onclick="openModal('images/20251214_Daylight Analysis.gif', 'Daylight Analysis')" style="max-width: 900px; margin: 0 auto; border-radius: 8px; overflow: hidden; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); cursor: pointer; transition: transform 0.3s ease, box-shadow 0.3s ease;">
                            <img src="images/20251214_Daylight Analysis.gif" alt="Daylight Analysis" style="width: 100%; height: auto; display: block; transition: transform 0.3s ease;">
                            <div class="gallery-caption" style="background: rgba(26, 29, 39, 0.8); color: #e8eaed; padding: 12px; text-align: center; font-size: 14px; transition: background-color 0.3s ease;">Daylight Analysis</div>
                        </div>
                    </div>

                    <div style="max-width: 900px; margin: 0 auto; padding: 25px; background: rgba(26, 29, 39, 0.5); border-radius: 8px; border-left: 4px solid #10b981;">
                        <h3 style="color: #10b981; margin-top: 0; margin-bottom: 15px;">Daylight Analysis</h3>
                        <p style="color: #b6bac5; line-height: 1.7; margin: 0;">
                            To identify which parts of the building require additional façade shading to mitigate excessive direct sunlight penetration, we first perform a daylight analysis on the building's basic massing. The results indicate that the south- and east-facing façades receive the highest levels of solar exposure. Based on this analysis, implementing shading strategies on these façades becomes a key design approach for reducing unwanted solar gain before finalizing the façade design.
                        </p>
                    </div>

                    <!-- View Analysis -->
                    <div style="margin-top: 40px; margin-bottom: 30px;">
                        <div class="gallery-item" onclick="openModal('images/20251214_View Analysis.gif', 'View Analysis')" style="max-width: 900px; margin: 0 auto; border-radius: 8px; overflow: hidden; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); cursor: pointer; transition: transform 0.3s ease, box-shadow 0.3s ease;">
                            <img src="images/20251214_View Analysis.gif" alt="View Analysis" style="width: 100%; height: auto; display: block; transition: transform 0.3s ease;">
                            <div class="gallery-caption" style="background: rgba(26, 29, 39, 0.8); color: #e8eaed; padding: 12px; text-align: center; font-size: 14px; transition: background-color 0.3s ease;">View Analysis</div>
                        </div>
                    </div>

                    <div style="max-width: 900px; margin: 0 auto; padding: 25px; background: rgba(26, 29, 39, 0.5); border-radius: 8px; border-left: 4px solid #8b5cf6;">
                        <h3 style="color: #8b5cf6; margin-top: 0; margin-bottom: 15px;">View Analysis</h3>
                        <p style="color: #b6bac5; line-height: 1.7; margin: 0;">
                            Based on the view analysis, the residential levels experience minimal visual obstruction, while the lower podium—housing retail, office, and common spaces—exhibits a higher degree of view blockage. As a result, we concentrate more complex and denser façade treatments at the podium level, where views are less critical, and employ a more transparent façade system for the upper residential levels to preserve unobstructed views.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Program Evolution Section -->
            <div class="gallery-section" style="margin-top: 60px; padding: 30px 0; background: rgba(26, 29, 39, 0.5); border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.1);">
                <h2 style="text-align: center; margin-bottom: 30px; color: #e8eaed;">Program Evolution</h2>
                
                <div style="max-width: 1200px; margin: 0 auto; padding: 0 20px;">
                    <!-- Program Flow Container -->
                    <div class="program-flow" style="position: relative; min-height: 100vh; width: 100%; overflow: auto;">
                        <!-- Background gradients -->
                        <div style="position: fixed; inset: 0; pointer-events: none; z-index: 0;">
                            <div style="position: absolute; top: 0; left: 0; width: 900px; height: 650px; background: rgba(6, 182, 212, 0.1); border-radius: 9999px; filter: blur(48px); opacity: 0.5; transform: translate(-20%, -20%);"></div>
                            <div style="position: absolute; bottom: 0; right: 0; width: 900px; height: 650px; background: rgba(99, 102, 241, 0.1); border-radius: 9999px; filter: blur(48px); opacity: 0.5; transform: translate(20%, 20%);"></div>
                        </div>

                        <div style="position: relative; max-width: 64rem; margin: 0 auto; padding: 2rem 1rem;">
                            <!-- Header -->
                            <header style="margin-bottom: 1.5rem; padding: 1.5rem; border-radius: 1rem; border: 1px solid rgba(255, 255, 255, 0.14); background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(20px);">
                                <div style="font-size: 0.6875rem; letter-spacing: 0.18em; text-transform: uppercase; color: #94a3b8; margin-bottom: 0.5rem;">
                                    Interactive Diagram
                                </div>
                                <h1 style="font-size: 1.5rem; line-height: 2rem; font-weight: 600; letter-spacing: -0.025em; color: #f1f5f9; margin-bottom: 0.5rem;">
                                    Program Evolution — 1225 Broadway
                                </h1>
                                <p style="font-size: 0.875rem; color: #94a3b8; line-height: 1.5;">
                                    Interactive flow from site context to final program. Click nodes to highlight, hover for emphasis.
                                </p>
                            </header>

                            <!-- Flow Container -->
                            <div style="padding: 1.5rem; border-radius: 1rem; border: 1px solid rgba(255, 255, 255, 0.14); background: rgba(255, 255, 255, 0.04); backdrop-filter: blur(20px);">
                                <!-- Nodes will be inserted here by JavaScript -->
                                <div id="program-flow-nodes"></div>
                            </div>

                            <!-- Footer Info -->
                            <div style="margin-top: 1.5rem; padding: 1rem; border-radius: 0.75rem; border: 1px solid rgba(255, 255, 255, 0.08); background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(20px);">
                                <p id="flow-info" style="font-size: 0.75rem; color: #64748b; text-align: center;">
                                    Click any node to select • Hover to emphasize
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Program Flow JavaScript -->
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const nodes = [
                        {
                            id: 1,
                            title: 'Site Context',
                            tag: 'Start',
                            isStart: true,
                            items: [
                                'Broadway at W 29th–30th Streets',
                                'Three street frontages',
                                'Zoning: M1-8A / R12'
                            ]
                        },
                        {
                            id: 2,
                            title: 'Zoning Analysis',
                            tag: 'Constraints',
                            items: [
                                'Base height to ~155\'',
                                'Setbacks above base height',
                                'As-of-right tower limit ~500\''
                            ]
                        },
                        {
                            id: 3,
                            title: 'Program Strategy',
                            tag: 'Mixed-use',
                            items: [
                                'Retail at base',
                                'Office mid-tower',
                                'Residential above'
                            ]
                        },
                        {
                            id: 4,
                            title: 'Massing Strategy',
                            tag: 'Form',
                            items: [
                                'Full lot coverage base',
                                'Progressive setbacks to tower',
                                'Target height: ~503\' (43 floors)'
                            ]
                        },
                        {
                            id: 5,
                            title: 'Key Decision',
                            tag: 'Selected',
                            items: [
                                'Asymmetric setbacks to preserve floor area',
                                '43 floors to maintain 10\' floor heights'
                            ]
                        },
                        {
                            id: 6,
                            title: 'Final Program',
                            tag: 'End',
                            isEnd: true,
                            items: [
                                '43 floors + mechanical',
                                '~835,113 SF GFA',
                                'Retail + Office + 325 Residential units'
                            ]
                        }
                    ];

                    let hoveredNode = null;
                    let selectedNode = null;
                    const flowContainer = document.getElementById('program-flow-nodes');
                    const flowInfo = document.getElementById('flow-info');

                    function renderNodes() {
                        flowContainer.innerHTML = '';
                        
                        nodes.forEach((node, index) => {
                            // Create node element
                            const nodeEl = document.createElement('div');
                            nodeEl.className = `program-node ${node.isStart || node.isEnd ? 'special-node' : ''} ${hoveredNode === node.id ? 'hovered' : ''} ${selectedNode === node.id ? 'selected' : ''}`;
                            nodeEl.style.position = 'relative';
                            nodeEl.style.padding = '1.25rem';
                            nodeEl.style.borderRadius = '1rem';
                            nodeEl.style.border = node.isStart || node.isEnd ? '1px solid rgba(34, 211, 238, 0.35)' : '1px solid rgba(255, 255, 255, 0.14)';
                            nodeEl.style.boxShadow = node.isStart || node.isEnd ? 'inset 0 0 0 1px rgba(22, 198, 226, 0.1)' : 'none';
                            nodeEl.style.transition = 'all 0.3s';
                            nodeEl.style.cursor = 'pointer';
                            nodeEl.style.marginBottom = index < nodes.length - 1 ? '0.5rem' : '0';
                            nodeEl.style.backgroundColor = hoveredNode === node.id ? 'rgba(255, 255, 255, 0.08)' : 'rgba(255, 255, 255, 0.05)';
                            nodeEl.style.transform = hoveredNode === node.id ? 'scale(1.02)' : 'scale(1)';
                            nodeEl.style.boxShadow = hoveredNode === node.id ? '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)' : 'none';
                            nodeEl.style.zIndex = hoveredNode === node.id ? '10' : '1';
                            nodeEl.style.border = selectedNode === node.id ? '2px solid rgba(14, 165, 233, 0.5)' : node.isStart || node.isEnd ? '1px solid rgba(34, 211, 238, 0.35)' : '1px solid rgba(255, 255, 255, 0.14)';
                            nodeEl.style.backgroundColor = selectedNode === node.id ? 'rgba(255, 255, 255, 0.1)' : hoveredNode === node.id ? 'rgba(255, 255, 255, 0.08)' : 'rgba(255, 255, 255, 0.05)';

                            // Add title row
                            const titleRow = document.createElement('div');
                            titleRow.style.display = 'flex';
                            titleRow.style.alignItems = 'center';
                            titleRow.style.justifyContent = 'space-between';
                            titleRow.style.gap = '0.75rem';
                            titleRow.style.marginBottom = '0.75rem';

                            const title = document.createElement('h3');
                            title.style.fontWeight = '800';
                            title.style.fontSize = '0.75rem';
                            title.style.letterSpacing = '0.12em';
                            title.style.textTransform = 'uppercase';
                            title.style.color = '#f1f5f9';
                            title.textContent = node.title;

                            const tag = document.createElement('span');
                            tag.style.fontSize = '0.625rem';
                            tag.style.letterSpacing = '0.12em';
                            tag.style.textTransform = 'uppercase';
                            tag.style.padding = '0.375rem 0.75rem';
                            tag.style.borderRadius = '9999px';
                            tag.style.border = '1px solid rgba(255, 255, 255, 0.14)';
                            tag.style.backgroundColor = 'rgba(255, 255, 255, 0.03)';
                            tag.style.whiteSpace = 'nowrap';
                            tag.style.transition = 'all 0.3s';
                            tag.style.color = hoveredNode === node.id ? '#7dd3fc' : '#cbd5e1';
                            tag.style.borderColor = hoveredNode === node.id ? 'rgba(125, 211, 252, 0.3)' : 'rgba(255, 255, 255, 0.14)';
                            tag.textContent = node.tag;

                            titleRow.appendChild(title);
                            titleRow.appendChild(tag);

                            // Add items list
                            const itemsList = document.createElement('ul');
                            itemsList.style.paddingLeft = '1rem';
                            itemsList.style.marginTop = '0.5rem';

                            node.items.forEach(item => {
                                const li = document.createElement('li');
                                li.style.fontSize = '0.875rem';
                                li.style.lineHeight = '1.25rem';
                                li.style.listStyleType = 'disc';
                                li.style.marginBottom = '0.5rem';
                                li.style.transition = 'color 0.3s';
                                li.style.color = hoveredNode === node.id || selectedNode === node.id ? '#e2e8f0' : '#94a3b8';
                                li.textContent = item;
                                itemsList.appendChild(li);
                            });

                            // Add selection indicator
                            if (selectedNode === node.id) {
                                const indicator = document.createElement('div');
                                indicator.style.position = 'absolute';
                                indicator.style.right = '-0.5rem';
                                indicator.style.top = '50%';
                                indicator.style.transform = 'translateY(-50%)';
                                indicator.style.width = '0.25rem';
                                indicator.style.height = '3rem';
                                indicator.style.backgroundColor = '#38bdf8';
                                indicator.style.borderRadius = '9999px';
                                indicator.style.animation = 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite';
                                nodeEl.appendChild(indicator);
                            }

                            // Add event listeners
                            nodeEl.addEventListener('mouseenter', () => {
                                hoveredNode = node.id;
                                renderNodes();
                            });

                            nodeEl.addEventListener('mouseleave', () => {
                                hoveredNode = null;
                                renderNodes();
                            });

                            nodeEl.addEventListener('click', () => {
                                selectedNode = selectedNode === node.id ? null : node.id;
                                flowInfo.textContent = selectedNode 
                                    ? `Selected: ${node.title}` 
                                    : 'Click any node to select • Hover to emphasize';
                                renderNodes();
                            });

                            // Assemble node
                            nodeEl.appendChild(titleRow);
                            nodeEl.appendChild(itemsList);
                            flowContainer.appendChild(nodeEl);

                            // Add arrow if not the last node
                            if (index < nodes.length - 1) {
                                const arrowContainer = document.createElement('div');
                                arrowContainer.style.height = '1rem';
                                arrowContainer.style.display = 'flex';
                                arrowContainer.style.alignItems = 'center';
                                arrowContainer.style.justifyContent = 'center';
                                arrowContainer.style.margin = '0.1rem 0';
                                arrowContainer.style.transition = 'all 0.3s ease';

                                const arrowSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                                arrowSvg.setAttribute('width', '12');
                                arrowSvg.setAttribute('height', '12');
                                arrowSvg.setAttribute('viewBox', '0 0 24 24');
                                arrowSvg.style.transition = 'all 0.3s ease';
                                arrowSvg.style.opacity = (hoveredNode === node.id || hoveredNode === (nodes[index + 1]?.id)) ? '0.6' : '0.2';

                                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                                line.setAttribute('x1', '12');
                                line.setAttribute('y1', '2');
                                line.setAttribute('x2', '12');
                                line.setAttribute('y2', '14');
                                line.setAttribute('stroke', '#e2e8f0');
                                line.setAttribute('stroke-width', '0.75');
                                line.setAttribute('stroke-linecap', 'round');

                                const polygon = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                                polygon.setAttribute('points', '9,12 12,15 15,12');
                                polygon.setAttribute('fill', '#e2e8f0');
                                polygon.setAttribute('stroke', 'none');

                                arrowSvg.appendChild(line);
                                arrowSvg.appendChild(polygon);
                                arrowContainer.appendChild(arrowSvg);
                                flowContainer.appendChild(arrowContainer);
                            }
                        });
                    }

                    // Add pulse animation
                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes pulse {
                            0%, 100% { opacity: 0.5; }
                            50% { opacity: 1; }
                        }
                    `;
                    document.head.appendChild(style);

                    // Initial render
                    renderNodes();

                    // Keyboard navigation
                    document.addEventListener('keydown', (e) => {
                        if (selectedNode !== null) {
                            if (e.key === 'ArrowUp' && selectedNode > 1) {
                                selectedNode--;
                                renderNodes();
                                updateInfo();
                            } else if (e.key === 'ArrowDown' && selectedNode < nodes.length) {
                                selectedNode++;
                                renderNodes();
                                updateInfo();
                            } else if (e.key === 'Escape') {
                                selectedNode = null;
                                renderNodes();
                                updateInfo();
                            }
                        }
                    });

                    function updateInfo() {
                        const node = nodes.find(n => n.id === selectedNode);
                        flowInfo.textContent = node 
                            ? `Selected: ${node.title}` 
                            : 'Click any node to select • Hover to emphasize';
                    }
                });
            </script>

    <!-- Load non-critical CSS asynchronously -->
    <script>
        // Image Gallery Functionality
        let currentImageIndex = 0;
        const images = [
            // Site Context Images
            {src: 'images/street.png', caption: 'Street View'},
            {src: 'images/Surrounding_Building_Types.png', caption: 'Building Types'},
            {src: 'images/Surrounding_transportation.png', caption: 'Transportation'},
            {src: 'images/Surrounding_vegetation.png', caption: 'Vegetation'},
            // Form Evolution Images
            {src: 'images/Form_iteration1.png', caption: 'Form Iteration 1 - Initial Concept'},
            {src: 'images/Form_iteration2.png', caption: 'Form Iteration 2 - Refined Form'},
            {src: 'images/Form_iteration3_1.png', caption: 'Form Iteration 3.1 - Variant A'},
            {src: 'images/Form_iteration3_2.png', caption: 'Form Iteration 3.2 - Variant B'},
            // Climate Analysis Images
            {src: 'images/Climate analysis.png', caption: 'Climate and Wind Analysis'},
            {src: 'images/Climate.png', caption: 'Climate Analysis'}
        ];

        function openModal(src, caption) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            const captionText = document.getElementById('caption');
            
            currentImageIndex = images.findIndex(img => img.src === src);
            
            // Add show class with a slight delay to allow display transition
            modal.style.display = 'block';
            setTimeout(() => {
                modal.classList.add('show');
            }, 10);
            
            // Set image source and caption
            modalImg.src = src;
            modalImg.onload = function() {
                // Fade in the image after it's loaded
                modalImg.style.opacity = '1';
            };
            captionText.innerHTML = caption;
            
            // Prevent scrolling when modal is open
            document.body.style.overflow = 'hidden';
            document.body.style.paddingRight = window.innerWidth - document.documentElement.clientWidth + 'px';
            document.body.classList.add('modal-open');
        }

        function closeModal() {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            
            // Fade out the modal
            modal.classList.remove('show');
            modalImg.style.opacity = '0';
            
            // Wait for the fade out animation to complete before hiding
            setTimeout(() => {
                modal.style.display = 'none';
                // Re-enable scrolling
                document.body.style.overflow = 'auto';
                document.body.style.paddingRight = '';
                document.body.classList.remove('modal-open');
            }, 300);
        }

        function plusSlides(n) {
            const modalImg = document.getElementById('modalImage');
            const captionText = document.getElementById('caption');
            
            // Fade out current image
            modalImg.style.opacity = '0';
            
            setTimeout(() => {
                // Update to new image
                currentImageIndex = (currentImageIndex + n + images.length) % images.length;
                modalImg.src = images[currentImageIndex].src;
                captionText.innerHTML = images[currentImageIndex].caption;
                
                // Fade in new image after it loads
                modalImg.onload = function() {
                    modalImg.style.opacity = '1';
                };
                
                // In case the image is cached
                if (modalImg.complete) {
                    modalImg.style.opacity = '1';
                }
            }, 200);
        }

        // Close modal when clicking outside the image
        window.onclick = function(event) {
            const modal = document.getElementById('imageModal');
            if (event.target == modal) {
                closeModal();
            }
        }

        // Keyboard navigation
        document.addEventListener('keydown', function(event) {
            const modal = document.getElementById('imageModal');
            if (modal.style.display === 'block') {
                if (event.key === 'Escape') {
                    closeModal();
                } else if (event.key === 'ArrowLeft') {
                    plusSlides(-1);
                } else if (event.key === 'ArrowRight') {
                    plusSlides(1);
                }
            }
        });

        // Load non-critical CSS after page load
        window.addEventListener('load', () => {
            // Example of loading non-critical CSS
            // loadCSS('path/to/non-critical.css');
            
            // Add any additional non-critical CSS loading here
            console.log('Non-critical resources loaded');
        });
        
        // Function to load CSS asynchronously
        function loadCSS(href) {
            return new Promise((resolve, reject) => {
                const link = document.createElement('link');
                link.rel = 'stylesheet';
                link.href = href;
                link.media = 'print';
                link.onload = () => {
                    link.media = 'all';
                    resolve(link);
                };
                link.onerror = reject;
                document.head.appendChild(link);
            });
        }
    </script>
    
    <script>
        // Initialize touch feedback system
        document.addEventListener('DOMContentLoaded', () => {
            // Add ripple effect to all elements with touch-feedback class
            const touchElements = document.querySelectorAll('.touch-feedback');
            
            touchElements.forEach(element => {
                // Create ripple container if it doesn't exist
                if (!element.querySelector('.ripple-container')) {
                    const rippleContainer = document.createElement('div');
                    rippleContainer.className = 'ripple-container';
                    element.style.position = 'relative';
                    element.style.overflow = 'hidden';
                    element.appendChild(rippleContainer);
                }
                
                // Add event listeners
                element.addEventListener('mousedown', createRipple);
                element.addEventListener('touchstart', createRipple, { passive: true });
                
                // Add touch glow effect
                element.addEventListener('mousedown', createTouchGlow);
                element.addEventListener('touchstart', createTouchGlow, { passive: true });
            });
            
            // Create ripple effect
            function createRipple(e) {
                const element = this;
                const rect = element.getBoundingClientRect();
                
                // Get position
                let x, y;
                if (e.type === 'mousedown') {
                    x = e.clientX - rect.left;
                    y = e.clientY - rect.top;
                } else if (e.touches) {
                    x = e.touches[0].clientX - rect.left;
                    y = e.touches[0].clientY - rect.top;
                }
                
                // Create ripple
                const ripple = document.createElement('div');
                ripple.className = 'ripple';
                ripple.style.left = `${x}px`;
                ripple.style.top = `${y}px`;
                
                // Add ripple to container
                const rippleContainer = element.querySelector('.ripple-container') || element;
                rippleContainer.appendChild(ripple);
                
                // Remove ripple after animation
                setTimeout(() => {
                    ripple.style.opacity = '0';
                    setTimeout(() => ripple.remove(), 300);
                }, 400);
                
                // Add touch active class
                element.classList.add('touch-active');
                setTimeout(() => element.classList.remove('touch-active'), 200);
            }
            
            // Create touch glow effect
            function createTouchGlow(e) {
                const element = this;
                const rect = element.getBoundingClientRect();
                
                // Get position
                let x, y;
                if (e.type === 'mousedown') {
                    x = e.clientX;
                    y = e.clientY;
                } else if (e.touches) {
                    x = e.touches[0].clientX;
                    y = e.touches[0].clientY;
                }
                
                // Create glow
                const glow = document.createElement('div');
                glow.className = 'touch-glow';
                glow.style.left = `${x}px`;
                glow.style.top = `${y}px`;
                
                document.body.appendChild(glow);
                
                // Trigger reflow
                void glow.offsetWidth;
                
                // Start animation
                glow.style.opacity = '0.5';
                glow.style.transform = 'translate(-50%, -50%) scale(1)';
                
                // Remove glow after animation
                setTimeout(() => {
                    glow.style.opacity = '0';
                    setTimeout(() => glow.remove(), 1000);
                }, 100);
            }
            
            // Initialize 3D tilt effect for cards
            const cards = document.querySelectorAll('.module-card');
            cards.forEach(card => {
                card.addEventListener('mousemove', handleCardTilt);
                card.addEventListener('mouseleave', resetCardTilt);
            });
            
            function handleCardTilt(e) {
                const card = this;
                const rect = card.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                const centerX = rect.width / 2;
                const centerY = rect.height / 2;
                const rotateX = (y - centerY) / 20;
                const rotateY = (centerX - x) / 20;
                
                card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.02, 1.02, 1.02)`;
            }
            
            function resetCardTilt() {
                this.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale3d(1, 1, 1)';
            }
            
            // Add loaded class to body when everything is ready
            document.body.classList.add('loaded');
        });
    </script>

    <!-- Floor Program Analysis Section -->
    <section class="py-16 bg-white" id="floor-program">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl font-bold text-center mb-12 text-gray-900">Floor-by-Floor Program Analysis</h2>
            <p class="text-center text-gray-600 mb-8 max-w-3xl mx-auto">1225 Broadway - Detailed Space Breakdown</p>
            <div class="floor-selector flex flex-wrap gap-2 justify-center mb-8" id="floorSelector"></div>
            
            <div class="main-grid grid grid-cols-1 lg:grid-cols-3 gap-6 mb-12">
                <div class="bubble-container bg-white rounded-xl shadow-lg overflow-hidden lg:col-span-2">
                    <div id="bubbleHeader" class="bubble-header bg-blue-600 text-white font-semibold text-lg p-4">Space Allocation Bubble Diagram</div>
                    <div id="bubbleChart" class="w-full h-[600px] bg-white"></div>
                </div>

                <div class="sidebar space-y-6">
                    <div class="card bg-white rounded-xl shadow-lg p-5" id="statsCard">
                        <h3 class="text-lg font-bold text-gray-900 mb-4">Floor Statistics</h3>
                        <div id="statsContent"></div>
                    </div>

                    <div class="card bg-white rounded-xl shadow-lg p-5 hidden" id="hoveredCard">
                        <h3 class="text-lg font-bold text-gray-900 mb-4" id="hoveredName"></h3>
                        <div id="hoveredContent"></div>
                    </div>

                    <div class="card bg-white rounded-xl shadow-lg p-5">
                        <h3 class="text-lg font-bold text-gray-900 mb-4">Space Breakdown</h3>
                        <div class="space-list max-h-96 overflow-y-auto" id="spaceList"></div>
                    </div>

                    <div class="quick-nav bg-gradient-to-br from-gray-50 to-gray-100 p-4 rounded-xl shadow-lg">
                        <h4 class="text-xs font-bold uppercase tracking-wider text-gray-900 mb-2">Quick Jump</h4>
                        <div class="grid grid-cols-2 gap-2">
                            <button class="quick-btn bg-red-500 hover:bg-red-600 text-white text-sm font-semibold py-2 px-3 rounded-lg transition-all duration-200 transform hover:-translate-y-0.5 hover:shadow-md" onclick="selectFloor('1')">Retail Floors</button>
                            <button class="quick-btn bg-blue-500 hover:bg-blue-600 text-white text-sm font-semibold py-2 px-3 rounded-lg transition-all duration-200 transform hover:-translate-y-0.5 hover:shadow-md" onclick="selectFloor('6-10')">Office Floors</button>
                            <button class="quick-btn bg-yellow-500 hover:bg-yellow-600 text-white text-sm font-semibold py-2 px-3 rounded-lg transition-all duration-200 transform hover:-translate-y-0.5 hover:shadow-md" onclick="selectFloor('16')">Amenity Deck</button>
                            <button class="quick-btn bg-green-500 hover:bg-green-600 text-white text-sm font-semibold py-2 px-3 rounded-lg transition-all duration-200 transform hover:-translate-y-0.5 hover:shadow-md" onclick="selectFloor('17-29')">Residential</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="summary-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="summary-card bg-red-500 text-white p-5 rounded-xl shadow-lg text-center">
                    <div class="summary-value text-3xl font-bold">122,700</div>
                    <div class="summary-label text-sm opacity-90">SF Retail NLA</div>
                    <div class="summary-sublabel text-xs opacity-75 mt-1">Floors 1-5</div>
                </div>
                <div class="summary-card bg-blue-500 text-white p-5 rounded-xl shadow-lg text-center">
                    <div class="summary-value text-3xl font-bold">213,531</div>
                    <div class="summary-label text-sm opacity-90">SF Office NLA</div>
                    <div class="summary-sublabel text-xs opacity-75 mt-1">Floors 6-15</div>
                </div>
                <div class="summary-card bg-green-500 text-white p-5 rounded-xl shadow-lg text-center">
                    <div class="summary-value text-3xl font-bold">325</div>
                    <div class="summary-label text-sm opacity-90">Residential Units</div>
                    <div class="summary-sublabel text-xs opacity-75 mt-1">Floors 16-43</div>
                </div>
                <div class="summary-card bg-yellow-500 text-white p-5 rounded-xl shadow-lg text-center">
                    <div class="summary-value text-3xl font-bold">33,940</div>
                    <div class="summary-label text-sm opacity-90">SF Outdoor Space</div>
                    <div class="summary-sublabel text-xs opacity-75 mt-1">Terraces + Balconies</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Concept Section -->
    <section class="py-16 bg-gradient-to-br from-gray-50 to-gray-100" id="concept">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl font-bold text-center mb-12 text-gray-900">Design Concept</h2>
            <div id="concept-venn-container" class="max-w-5xl mx-auto">
                <!-- D3.js will render the Venn diagram here -->
            </div>
            
            <!-- Design Concept Thumbnails -->
            <div class="mt-16">
                <h3 class="text-2xl font-semibold text-center mb-8 text-gray-800">Design Inspirations & Concepts</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-6 max-w-5xl mx-auto">
                    <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-shadow duration-300">
                        <img src="images/Sail Shaped Facade Structure.png" alt="Sail Shaped Facade Structure" class="w-full h-48 object-cover">
                        <div class="p-4">
                            <p class="text-sm text-gray-600">Sail-Inspired Facade</p>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-shadow duration-300">
                        <img src="images/Facade_CapitaSpring_BIG.png" alt="CapitaSpring Facade by BIG" class="w-full h-48 object-cover">
                        <div class="p-4">
                            <p class="text-sm text-gray-600">Vertical Garden Facade</p>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-shadow duration-300">
                        <img src="images/concept evaluation.png" alt="Concept Evaluation 1" class="w-full h-48 object-cover">
                        <div class="p-4">
                            <p class="text-sm text-gray-600">Concept Evolution</p>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-shadow duration-300">
                        <img src="images/concept evaluation2.png" alt="Concept Evaluation 2" class="w-full h-48 object-cover">
                        <div class="p-4">
                            <p class="text-sm text-gray-600">Design Development</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Balcony Animation Section -->
    <section class="py-16 bg-gray-50">
        <div class="container mx-auto px-4">
            <div class="max-w-5xl mx-auto">
                <h2 class="text-3xl font-bold text-center mb-8 text-gray-900">Balcony Animation</h2>
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <img 
                        src="images/balconies.gif" 
                        alt="Balcony Design Animation" 
                        class="w-full h-auto object-contain"
                    >
                </div>
            </div>
        </div>
    </section>

    <!-- Facade Design Section -->
    <section class="py-16 bg-white" id="facade-design">
        <div class="container mx-auto px-4">
            <div class="max-w-5xl mx-auto">
                <h2 class="text-3xl font-bold text-center mb-8 text-gray-900">Facade Design Strategy</h2>
                <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8">
                    <img src="images/20251214_Facade Diagram.png" alt="Facade Design Strategies" class="w-full h-auto object-contain">
                </div>
                <div class="prose max-w-4xl mx-auto text-gray-700">
                    <p class="text-lg leading-relaxed">
                        Based on the results of the previous analysis, our façade design strategy is divided into two components. First, a curtain wall system is applied as the base façade across all building modules. Second, at the podium level—which accommodates office, retail, and common spaces—a curved, wavy parametric screen is introduced outside the curtain wall at varying depths. This layered façade system provides solar shading while allowing controlled openings that facilitate natural ventilation for interior spaces. The geometry and depth variation of the screen further enhance environmental performance while contributing to the architectural expression of the podium.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- D3.js Library -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- Floor Program Bubbles -->
    <script>
        // Floor Program Bubbles Data
        const buildingData = {
            "1": {
                name: "FLOOR 1 - RETAIL + LOBBIES",
                height: "0' - 18'",
                totalArea: 30550,
                color: "#ef4444",
                spaces: [
                    { name: "Retail", area: 12000, color: "#f87171", type: "leasable" },
                    { name: "Public Arcade", area: 10000, color: "#fbbf24", type: "public" },
                    { name: "Residential Lobby", area: 1800, color: "#60a5fa", type: "circulation" },
                    { name: "Office Lobby", area: 1500, color: "#34d399", type: "circulation" },
                    { name: "Elevator Core", area: 2000, color: "#94a3b8", type: "core" },
                    { name: "Service/Loading", area: 1500, color: "#cbd5e1", type: "core" },
                    { name: "MEP/Electrical", area: 1000, color: "#e2e8f0", type: "core" },
                    { name: "Stairs", area: 500, color: "#f1f5f9", type: "core" },
                    { name: "Restrooms", area: 250, color: "#f8fafc", type: "support" }
                ]
            },
            "2": {
                name: "FLOOR 2 - RETAIL + TERRACE",
                height: "18' - 36'",
                totalArea: 30550,
                color: "#ef4444",
                spaces: [
                    { name: "Retail", area: 12000, color: "#f87171", type: "leasable" },
                    { name: "Outdoor Terrace", area: 10000, color: "#a7f3d0", type: "amenity" },
                    { name: "Escalators", area: 600, color: "#fcd34d", type: "circulation" },
                    { name: "Elevator Shafts", area: 2000, color: "#94a3b8", type: "core" },
                    { name: "Stairs", area: 500, color: "#cbd5e1", type: "core" },
                    { name: "MEP Shafts", area: 600, color: "#e2e8f0", type: "core" },
                    { name: "Restrooms", area: 800, color: "#f1f5f9", type: "support" },
                    { name: "Storage/Janitor", area: 250, color: "#f8fafc", type: "support" },
                    { name: "Corridors", area: 3800, color: "#fef3c7", type: "circulation" }
                ]
            },
            "3-5": {
                name: "FLOORS 3-5 - RETAIL",
                height: "36' - 81'",
                totalArea: 30550,
                color: "#ef4444",
                spaces: [
                    { name: "Retail Space", area: 22100, color: "#f87171", type: "leasable" },
                    { name: "Escalators (Fl 3)", area: 600, color: "#fcd34d", type: "circulation" },
                    { name: "Elevator Shafts", area: 2000, color: "#94a3b8", type: "core" },
                    { name: "Stairs", area: 500, color: "#cbd5e1", type: "core" },
                    { name: "MEP Shafts", area: 600, color: "#e2e8f0", type: "core" },
                    { name: "Restrooms", area: 800, color: "#f1f5f9", type: "support" },
                    { name: "Electrical/IDF", area: 400, color: "#f8fafc", type: "core" },
                    { name: "Storage", area: 250, color: "#fef3c7", type: "support" },
                    { name: "Corridors", area: 3300, color: "#fef3c7", type: "circulation" }
                ]
            },
            "6-10": {
                name: "FLOORS 6-10 - OFFICE BASE",
                height: "81' - 151'",
                totalArea: 30550,
                color: "#3b82f6",
                spaces: [
                    { name: "Office Space", area: 25750, color: "#60a5fa", type: "leasable" },
                    { name: "Elevator Shafts", area: 2000, color: "#94a3b8", type: "core" },
                    { name: "Stairs", area: 500, color: "#cbd5e1", type: "core" },
                    { name: "MEP Shafts", area: 700, color: "#e2e8f0", type: "core" },
                    { name: "Restrooms", area: 1000, color: "#dbeafe", type: "support" },
                    { name: "Electrical/IDF", area: 400, color: "#f1f5f9", type: "core" },
                    { name: "Storage", area: 250, color: "#f8fafc", type: "support" },
                    { name: "Corridors", area: 2350, color: "#f3f4f6", type: "circulation" }
                ]
            },
            "11-15": {
                name: "FLOORS 11-15 - OFFICE MID",
                height: "151' - 211'",
                totalArea: 28000,
                color: "#3b82f6",
                spaces: [
                    { name: "Office Space", area: 24000, color: "#60a5fa", type: "leasable" },
                    { name: "Elevator Shafts", area: 1500, color: "#94a3b8", type: "core" },
                    { name: "Stairs", area: 500, color: "#cbd5e1", type: "core" },
                    { name: "MEP Shafts", area: 600, color: "#e2e8f0", type: "core" },
                    { name: "Restrooms", area: 800, color: "#dbeafe", type: "support" },
                    { name: "Corridors", area: 1600, color: "#f3f4f6", type: "circulation" }
                ]
            },
            "16": {
                name: "FLOOR 16 - AMENITY DECK",
                height: "221' - 232'",
                totalArea: 17422,
                color: "#fbbf24",
                spaces: [
                    { name: "Resident Lounge", area: 3000, color: "#fcd34d", type: "amenity" },
                    { name: "Fitness Center", area: 2500, color: "#f59e0b", type: "amenity" },
                    { name: "Co-Working Space", area: 2000, color: "#d97706", type: "amenity" },
                    { name: "Outdoor Terrace", area: 5000, color: "#a7f3d0", type: "amenity" },
                    { name: "Elevator Core", area: 1500, color: "#94a3b8", type: "core" },
                    { name: "Stairs", area: 500, color: "#cbd5e1", type: "core" },
                    { name: "MEP/Electrical", area: 1000, color: "#e2e8f0", type: "core" },
                    { name: "Restrooms", area: 800, color: "#f1f5f9", type: "support" },
                    { name: "Storage", area: 250, color: "#f8fafc", type: "support" },
                    { name: "Corridors", area: 1872, color: "#fef3c7", type: "circulation" }
                ]
            },
            "17-29": {
                name: "FLOORS 17-29 - RESIDENTIAL",
                height: "232' - 436'",
                totalArea: 16200,
                color: "#10b981",
                spaces: [
                    { name: "Residential Units", area: 12000, color: "#34d399", type: "residential" },
                    { name: "Corridors", area: 1500, color: "#a7f3d0", type: "circulation" },
                    { name: "Elevator Core", area: 1200, color: "#94a3b8", type: "core" },
                    { name: "Stairs", area: 500, color: "#cbd5e1", type: "core" },
                    { name: "MEP Shafts", area: 500, color: "#e2e8f0", type: "core" },
                    { name: "Trash/Recycling", area: 200, color: "#f1f5f9", type: "support" },
                    { name: "Storage", area: 300, color: "#f8fafc", type: "support" }
                ]
            },
            "30-43": {
                name: "FLOORS 30-43 - PENTHOUSES",
                height: "436' - 605'",
                totalArea: 12500,
                color: "#10b981",
                spaces: [
                    { name: "Penthouse Units", area: 9000, color: "#34d399", type: "residential" },
                    { name: "Private Terraces", area: 2000, color: "#a7f3d0", type: "amenity" },
                    { name: "Corridors", area: 1000, color: "#d1fae5", type: "circulation" },
                    { name: "Elevator Core", area: 800, color: "#94a3b8", type: "core" },
                    { name: "Stairs", area: 400, color: "#cbd5e1", type: "core" },
                    { name: "MEP Shafts", area: 400, color: "#e2e8f0", type: "core" },
                    { name: "Storage", area: 200, color: "#f8fafc", type: "support" }
                ]
            }
        };

        const floorOptions = [
            { id: "1", label: "Floor 1" },
            { id: "2", label: "Floor 2" },
            { id: "3-5", label: "Floors 3-5" },
            { id: "6-10", label: "Floors 6-10" },
            { id: "11-15", label: "Floors 11-15" },
            { id: "16", label: "Floor 16 (Amenity)" },
            { id: "17-29", label: "Floors 17-29" },
            { id: "30-43", label: "Floors 30-43" }
        ];

        let currentFloor = "1";
        let hoveredSpace = null;

        // Initialize floor selector buttons
        function initFloorSelector() {
            const container = document.getElementById('floorSelector');
            floorOptions.forEach(floor => {
                const btn = document.createElement('button');
                btn.className = 'px-4 py-2 rounded-lg font-medium transition-colors';
                btn.className += floor.id === currentFloor 
                    ? ' bg-blue-600 text-white' 
                    : ' bg-gray-200 text-gray-700 hover:bg-gray-300';
                btn.textContent = floor.label;
                btn.onclick = () => selectFloor(floor.id);
                container.appendChild(btn);
            });
        }

        // Update active button
        function updateActiveButton() {
            document.querySelectorAll('#floorSelector button').forEach(btn => {
                const floorId = btn.getAttribute('data-floor');
                btn.className = 'px-4 py-2 rounded-lg font-medium transition-colors';
                btn.className += floorId === currentFloor 
                    ? ' bg-blue-600 text-white' 
                    : ' bg-gray-200 text-gray-700 hover:bg-gray-300';
            });
        }

        // Select floor
        function selectFloor(floorId) {
            currentFloor = floorId;
            updateActiveButton();
            renderBubbles();
            updateStats();
            updateSpaceList();
        }

        // Update statistics
        function updateStats() {
            const floorData = buildingData[currentFloor];
            const statsContent = document.getElementById('statsContent');
            
            if (!floorData) return;
            
            // Clear existing content
            statsContent.innerHTML = '';
            
            // Add floor name
            const nameRow = document.createElement('div');
            nameRow.className = 'mb-4';
            nameRow.innerHTML = `
                <div class="text-sm text-gray-500">Current Floor</div>
                <div class="text-lg font-semibold text-gray-900">${floorData.name}</div>
                <div class="text-sm text-gray-500 mt-1">Height: ${floorData.height}</div>
            `;
            statsContent.appendChild(nameRow);
            
            // Add stats
            const stats = [
                { label: 'Total Area', value: floorData.totalArea.toLocaleString() + ' SF' },
                { label: 'Floor to Floor', value: currentFloor.includes('-') ? 'Multiple' : 'Single' },
                { label: 'Space Types', value: [...new Set(floorData.spaces.map(s => s.type))].length }
            ];
            
            stats.forEach(stat => {
                const row = document.createElement('div');
                row.className = 'flex justify-between py-2 border-b border-gray-100';
                row.innerHTML = `
                    <span class="text-sm text-gray-600">${stat.label}</span>
                    <span class="font-medium">${stat.value}</span>
                `;
                statsContent.appendChild(row);
            });
            
            // Add space type breakdown
            const typeBreakdown = {};
            floorData.spaces.forEach(space => {
                typeBreakdown[space.type] = (typeBreakdown[space.type] || 0) + space.area;
            });
            
            const breakdownTitle = document.createElement('div');
            breakdownTitle.className = 'mt-4 mb-2 text-sm font-semibold text-gray-700';
            breakdownTitle.textContent = 'Area by Type';
            statsContent.appendChild(breakdownTitle);
            
            Object.entries(typeBreakdown).forEach(([type, area]) => {
                const percentage = ((area / floorData.totalArea) * 100).toFixed(1);
                const row = document.createElement('div');
                row.className = 'mb-2';
                row.innerHTML = `
                    <div class="flex justify-between text-xs mb-1">
                        <span class="capitalize">${type}</span>
                        <span>${percentage}%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-blue-500 h-2 rounded-full" style="width: ${percentage}%"></div>
                    </div>
                `;
                statsContent.appendChild(row);
            });
        }

        // Update space list
        function updateSpaceList() {
            const spaceList = document.getElementById('spaceList');
            const floorData = buildingData[currentFloor];
            
            if (!floorData) return;
            
            // Sort spaces by area (descending)
            const sortedSpaces = [...floorData.spaces].sort((a, b) => b.area - a.area);
            
            spaceList.innerHTML = '';
            
            sortedSpaces.forEach(space => {
                const percentage = ((space.area / floorData.totalArea) * 100).toFixed(1);
                const item = document.createElement('div');
                item.className = `space-item cursor-pointer hover:bg-gray-50 rounded-lg p-3 transition-colors ${hoveredSpace === space.name ? 'bg-blue-50' : ''}`;
                item.onmouseenter = () => updateHoveredCard(space);
                item.onmouseleave = () => updateHoveredCard(null);
                
                item.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-3 h-3 rounded-full mr-2" style="background-color: ${space.color}"></div>
                        <span class="text-sm font-medium text-gray-800">${space.name}</span>
                    </div>
                    <div class="text-sm font-semibold text-gray-900">${space.area.toLocaleString()} SF</div>
                `;
                
                spaceList.appendChild(item);
            });
        }

        // Update hovered card
        function updateHoveredCard(space) {
            const hoveredCard = document.getElementById('hoveredCard');
            const hoveredName = document.getElementById('hoveredName');
            const hoveredContent = document.getElementById('hoveredContent');
            
            if (!space) {
                hoveredCard.style.display = 'none';
                hoveredSpace = null;
                return;
            }
            
            hoveredSpace = space.name;
            hoveredName.textContent = space.name;
            
            const floorData = buildingData[currentFloor];
            const percentage = ((space.area / floorData.totalArea) * 100).toFixed(1);
            
            hoveredContent.innerHTML = `
                <div class="space-y-3">
                    <div class="flex items-center">
                        <div class="w-4 h-4 rounded-full mr-2" style="background-color: ${space.color}"></div>
                        <span class="text-sm font-medium text-gray-800">${space.type}</span>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <div class="text-xs text-gray-500">Area</div>
                            <div class="font-semibold">${space.area.toLocaleString()} SF</div>
                        </div>
                        <div>
                            <div class="text-xs text-gray-500">% of Floor</div>
                            <div class="font-semibold">${percentage}%</div>
                        </div>
                    </div>
                    <div class="text-xs text-gray-500">
                        Click on the bubble in the diagram to highlight this space.
                    </div>
                </div>
            `;
            
            hoveredCard.style.display = 'block';
        }

        // Render bubble chart
        function renderBubbles() {
            const floorData = buildingData[currentFloor];
            if (!floorData) return;
            
            const width = document.getElementById('bubbleChart').offsetWidth;
            const height = 600;
            const margin = { top: 20, right: 20, bottom: 40, left: 20 };
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;
            
            // Clear previous chart
            d3.select('#bubbleChart').select('svg').remove();
            
            // Create SVG
            const svg = d3.select('#bubbleChart')
                .append('svg')
                .attr('width', '100%')
                .attr('height', height)
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');
            
            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);
            
            // Create simulation
            const simulation = d3.forceSimulation(floorData.spaces)
                .force('charge', d3.forceManyBody().strength(5))
                .force('center', d3.forceCenter(innerWidth / 2, innerHeight / 2))
                .force('collision', d3.forceCollide().radius(d => Math.sqrt(d.area) / 1.5))
                .on('tick', ticked);
            
            // Create bubbles
            const bubbles = g.selectAll('circle')
                .data(floorData.spaces)
                .enter()
                .append('g')
                .attr('class', 'bubble')
                .on('mouseover', function(event, d) {
                    d3.select(this).select('circle')
                        .transition()
                        .duration(200)
                        .attr('r', d => Math.sqrt(d.area) / 1.3)
                        .attr('stroke', '#000')
                        .attr('stroke-width', 2);
                    
                    updateHoveredCard(d);
                })
                .on('mouseout', function(event, d) {
                    if (hoveredSpace !== d.name) {
                        d3.select(this).select('circle')
                            .transition()
                            .duration(200)
                            .attr('r', d => Math.sqrt(d.area) / 1.5)
                            .attr('stroke', 'none');
                        
                        if (hoveredSpace === d.name) {
                            updateHoveredCard(null);
                        }
                    }
                });
            
            // Add circles
            bubbles.append('circle')
                .attr('r', d => Math.sqrt(d.area) / 1.5)
                .attr('fill', d => d.color)
                .attr('stroke', 'none')
                .attr('stroke-width', 2)
                .attr('opacity', 0.8);
            
            // Add text labels
            bubbles.append('text')
                .attr('text-anchor', 'middle')
                .attr('dy', '.3em')
                .attr('font-size', d => Math.min(Math.sqrt(d.area) / 10, 12))
                .attr('fill', '#1f2937')
                .text(d => d.area > 1000 ? `${d.name}\n${(d.area / 1000).toFixed(0)}K SF` : d.name);
            
            // Update positions on simulation tick
            function ticked() {
                bubbles.attr('transform', d => `translate(${Math.max(10, Math.min(innerWidth - 10, d.x))},${Math.max(10, Math.min(innerHeight - 10, d.y))})`);
            }
            
            // Update header
            document.getElementById('bubbleHeader').textContent = floorData.name;
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initFloorSelector();
            renderBubbles();
            updateStats();
            updateSpaceList();
            
            // Handle window resize
            let resizeTimer;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(() => {
                    renderBubbles();
                }, 250);
            });
        });
    </script>
    <!-- Concept Venn Diagram -->
    <script src="js/concept-venn.js"></script>
    <!-- Balcony Facade Diagram -->
    <script src="js/balcony-facade.js"></script>

    <!-- Whole Model Render Section -->
    <section class="py-16 bg-white">
        <div class="container mx-auto px-4">
            <div class="max-w-6xl mx-auto">
                <h2 class="text-3xl font-bold text-center mb-8 text-gray-900">Complete Building Model</h2>
                <div class="bg-white rounded-xl shadow-2xl overflow-hidden">
                    <img 
                        src="images/20251214_Whole Model Render.png" 
                        alt="Complete Building Model Render" 
                        class="w-full h-auto object-contain"
                        onclick="openModal('images/20251214_Whole Model Render.png', 'Complete Building Model')"
                        style="cursor: zoom-in;"
                    >
                </div>
                <p class="mt-4 text-center text-gray-600">Click the image to view in full screen</p>
            </div>
        </div>
    </section>

    <!-- Image Modal -->
    <div id="imageModal" class="modal">
        <span class="close" onclick="closeModal()">&times;</span>
        <img class="modal-content" id="modalImage">
        <div id="caption"></div>
        <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
        <a class="next" onclick="plusSlides(1)">&#10095;</a>
    </div>

    <style>
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            opacity: 0;
            transition: opacity 0.3s ease;
            overflow: auto;
        }
        
        .modal.show {
            opacity: 1;
        }
        
        .modal-content {
            margin: auto;
            display: block;
            max-width: 90%;
            max-height: 80vh;
            margin-top: 5vh;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        #caption {
            margin: 15px auto;
            display: block;
            width: 80%;
            max-width: 700px;
            text-align: center;
            color: #ccc;
            padding: 10px 0;
            height: 150px;
        }
        
        .close {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            transition: 0.3s;
            cursor: pointer;
        }
        
        .close:hover,
        .close:focus {
            color: #bbb;
            text-decoration: none;
            cursor: pointer;
        }
        
        .prev, .next {
            cursor: pointer;
            position: absolute;
            top: 50%;
            width: auto;
            padding: 16px;
            margin-top: -22px;
            color: white;
            font-weight: bold;
            font-size: 20px;
            transition: 0.3s;
            user-select: none;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 0 3px 3px 0;
        }
        
        .next {
            right: 0;
            border-radius: 3px 0 0 3px;
        }
        
        .prev:hover, .next:hover {
            background-color: rgba(0, 0, 0, 0.8);
        }
    </style>
</body>
</html>